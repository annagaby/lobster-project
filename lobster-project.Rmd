---
title: "lobster-project"
author: "Anna Calle"
date: "11/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
# Load packages and read .csv files
install.packages("vcdExtra")
library(tidyverse)
library(vcdExtra)
library(car)
library(onewaytests)
library(kableExtra)

size_abundance <- read_csv("lobster_size_abundance.csv")
traps <- read_csv("lobster_traps.csv")

#You will be describing lobster size, abundance and fishing pressure at five Long-Term Ecological Research (LTER) Sites in the Santa Barbara Channel close to the mainland: Arroyo Quemado (AQUE), Naples Reef (NAPL), Mohawk Reef (MOHK), Isla Vista (IVEE), Carpinteria (CARP).
```

### 1. Lobster abundance and fishing pressure (2012 - 2017)
Describe trends in lobster abundance (counts) and fishing pressure (trap buoys) at the five locations from 2012 - 2017. Ignore transect information - we are only interested in evaluating abundance and pressure on the
order of SITE. Note: you are not expected to use regression here - just think of ways to clearly describe annual totals visually and in text, noting important trends, events and differences.

```{r}
# Transform data into case form

size_abundance <- data.frame(size_abundance)
size_abun_case <- expand.dft(size_abundance, freq = "COUNT")

#create table of lobster abundance by site and year

abundance_table <- size_abun_case %>% 
  count(YEAR, SITE) %>% 
  spread(SITE, n)

abundance_table 

final_table_lobsters <- kable(abundance_table, col.names = c("Year", "Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk Reef", "Naples Reef"), align = "c") %>% 
   kable_styling(bootstrap_options = "striped", full_width = F) %>% 
  kable_styling(bootstrap_options = "hover") %>% 
  column_spec(1, bold = T) %>% 
  row_spec(0, bold = T, color = "black")

final_table_lobsters

#create table of trap buoy counts by site and year 

traps <- data.frame(traps)
traps_case <- expand.dft(traps, freq = "TRAPS")

traps_table <-traps_case %>% 
  count(YEAR, SITE) %>% 
  spread(SITE, n)

traps_table

final_traps_table <- kable(traps_table, col.names = c("Year", "Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk Reef", "Naples Reef"), align = "c") %>% 
   kable_styling(bootstrap_options = "striped", full_width = F) %>% 
  kable_styling(bootstrap_options = "hover") %>% 
  column_spec(1, bold = T) %>% 
  row_spec(0, bold = T, color = "black")
  
```


### 2. Compare mean lobster size by site in 2017
Compare mean lobster sizes (carapace length (mm)) across the five sites for lobster observations collected in 2017. Warning: the size data are not in tidy format. There are rows that contain size information for multiple
lobsters observed (e.g., if the researcher saw 3 lobsters all with carapace length ~ 60 mm, then they will have a single row where COUNT = 3 and SIZE = 60). You’ll want to get this into case format - where each lobster has its own row - before doing statistical analyses. There are many ways to do this. One hint: function expand.dft in the vcdExtra package (it doesn’t like tibbles, so you might need to coerce to data.frame first).
```{r}
# Compare mean lobster sizes across sites 

#Create dataframe with only 2017 observations to run ANOVA

mean_sizes <- size_abun_case %>% 
  filter(YEAR == 2017)


#Use Levene's test for equal variances 

#H0: Variances are equal
#HA: Variances are not equal 

lobster_variance <- leveneTest(SIZE ~ SITE, data = mean_sizes)

lobster_variance

#ANOVA test 

#H0: There is no difference in mean lobster sizes across different sites
#HA: At least two sites have significantly different means

lobster_aov <- aov(SIZE ~SITE, data = mean_sizes)
summary(lobster_aov)

#Kruskal- Wallis test for non-parametic data

#H0: There is no significant difference in mean lobster sizes across different sites
#HA: At least two sites have signficantly different means


# ANOVA eveals tht there are at least two means that are significantly different, therefore, we should run Tukey's HSD to explore further (post hoc test)

lobster_ph <- TukeyHSD(lobster_aov)

lobster_ph


# Mean lobster sizes differ significantly between NAPL and CARP, NAPL and IVEE, NAPL and MOHK (p < 0,05)   


```


### 3. Changes in lobster size at MPA and non-MPA sites (comparing only 2012 and 2017 sizes)
At Isla Vista and Naples Reef, the two protected MPA sites (with zero fishing pressure), how do lobster sizes in 2012 and 2017 compare? At the non-MPA sites?


### 4. Proportions of “legal” lobsters at the 5 sites in 2017
The legal minimum carapace size for lobster is 82.6 mm. What proportion of observed lobsters at each site are above the legal minimum? Does that proportion differ significantly across the 5 sites? 

